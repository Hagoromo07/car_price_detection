{% extends "bootstrap/base.html" %}
{% block title %}Configuration du v√©hicule{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="text-center mb-5">Configurer votre v√©hicule</h2>

    <form id="predict-form">
        <div class="row g-4">
            <!-- üü¶ Champs √† s√©lection multiple (2 colonnes) -->
            {% for label, name, options in [
            ("Confort & Commodit√©s", "comfort_convenience", comfort_convenience),
            ("Divertissement & M√©dias", "entertainment_media", entertainment_media),
            ("Extras", "extras", extras),
            ("S√©curit√©", "safety_security", safety_security)
            ] %}
            <div class="col-md-6">
                <label class="form-label fw-semibold">{{ label }}</label>
                <select class="form-select" name="{{ name }}" multiple size="5">
                    {% for option in options %}
                    <option value="{{ option }}">{{ option }}</option>
                    {% endfor %}
                </select>
                <small class="text-muted">S√©lection multiple possible</small>
            </div>
            {% endfor %}
            <!-- üü© Champs de s√©lection simple (3 colonnes fluides) -->
            {% for label, name, options in [
            ("Carburant", "fuel", fuel),
            ("Type de v√©hicule", "type", type),
            ("Carrosserie", "body_type", body_type),
            ("Marque / Mod√®le", "make_model", make_model),
            ("Type de peinture", "pain_type", pain_type),
            ("Sellerie", "upholstery_type", upholstery_type),
            ("Bo√Æte de vitesses", "gearing_type", gearing_type),
            ("Cha√Æne motrice", "drive_chain", drive_chain),
            ("Consommation combin√©e", "cons_comb", cons_comb),
            ("Nombre de vitesses", "gears", gears)
            ] %}
            <div class="col-md-4">
                <label class="form-label fw-semibold">{{ label }}</label>
                <select class="form-select" name="{{ name }}">
                    <option disabled selected>-- Choisir --</option>
                    {% for option in options %}
                    <option value="{{ option }}">{{ option }}</option>
                    {% endfor %}
                </select>
            </div>
            {% endfor %}

            <!-- üî¢ Champs num√©riques (2 colonnes) -->
            {% for label, name, value in [
            ("Cylindr√©e (cm¬≥)", "displacement_cc", displacement_cc),
            ("Poids (kg)", "weight_kg", weight_kg),
            ("√Çge du v√©hicule", "age", age),
            ("Kilom√©trage", "km", km)
            ] %}
            <div class="col-md-6">
                <label class="form-label fw-semibold">{{ label }}</label>
                <input type="number" class="form-control" name="{{ name }}" min="0" step="any" value="{{ value }}">
            </div>
            {% endfor %}
        </div>

        <div class="text-center mt-5">
            <button type="submit" class="btn btn-primary btn-lg px-5 py-2 rounded-pill shadow">
                üöó Pr√©dire le prix
            </button>
        </div>
    </form>
</div>

<script>
    document.getElementById('predict-form').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = {};
        for (let [key, value] of formData.entries()) {
            if (data[key]) {
                if (!Array.isArray(data[key])) data[key] = [data[key]];
                data[key].push(value);
            } else {
                data[key] = value;
            }
        }

        const response = await fetch("{{ url_for('main.predict_rpc') }}", {
            method: "POST",
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        const result = await response.json();
        alert("Prix pr√©dit : " + result.prediction + " ‚Ç¨");
    });
</script>
{% endblock %}
